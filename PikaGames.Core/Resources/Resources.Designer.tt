<#@ template hostspecific="true" language="C#" #>
<#@ output extension=".cs" #>
<#@ assembly name="EnvDTE"#>
<#@ assembly name="System.Xml"#>
<#@ import namespace="System.IO" #>
<#@ import namespace="System.Xml" #>
<#@ import namespace="System.Collections.Generic" #>
<#
string path = this.Host.ResolvePath("");
XmlDocument doc = new XmlDocument();
doc.Load(path + @"\Resources.xml");

var hostServiceProvider = (IServiceProvider)Host;
var dte = 
    (EnvDTE.DTE)hostServiceProvider.GetService(typeof(EnvDTE.DTE));
var activeSolutionProjects = (Array)dte.ActiveSolutionProjects;
var dteProject = (EnvDTE.Project)activeSolutionProjects.GetValue(0);
var defaultNamespace = 
    dteProject.Properties.Item("DefaultNamespace").Value;
var templateDir = Path.GetDirectoryName(Host.TemplateFile);
var fullPath = dteProject.Properties.Item("FullPath").Value.ToString();
fullPath = 
    fullPath.EndsWith("\\") 
        ? fullPath.Substring(0, fullPath.Length-1) 
        : fullPath;
var subNamespace = 
    templateDir.Replace(fullPath, string.Empty).Replace("\\", ".");
var fileNamespace = string.Concat(defaultNamespace, subNamespace);

#>
using System;
using System.Collections.Generic;
using System.Diagnostics;
using Microsoft.Xna.Framework;
using Microsoft.Xna.Framework.Audio;
using Microsoft.Xna.Framework.Content;
using Microsoft.Xna.Framework.Graphics;

namespace <#= defaultNamespace #>
{

	public static class Resources
	{
        private static ContentManager Content;
        private static GraphicsDevice GraphicsDevice;
	
<#

	XmlNode root = doc.SelectSingleNode("//Resources");

	foreach(XmlNode resourceNode in root.ChildNodes) {
#>

		public static class <#= resourceNode.Name #>
		{

<#
		foreach(XmlNode resource in resourceNode.ChildNodes) {
			if(resource.Name != "Parameters") {
#>
			public static <#= resource.Name #> <#= resource.Attributes["name"].Value #> { get; private set; }

<#
            }
		} // foreach ChildNodes
#>
			internal static void Init()
			{
<#
			foreach(XmlNode resource in resourceNode.ChildNodes) {
				if(resource.Name != "Parameters") {
#>
				<#= resource.Attributes["name"].Value #> = Content.Load<<#= resource.Name #>>("<#= resourceNode.Name #>/<#= Path.ChangeExtension(resource.Attributes["src"].Value, null) #>");
<#
				}
            }
#>
			}
		}

<#
	} // foreach
	
#>

        internal static void Init(ContentManager contentManager, GraphicsDevice graphicsDevice)
        {
            Content = new ContentManager(contentManager.ServiceProvider, "Content");
            GraphicsDevice = graphicsDevice;

<#
		foreach(XmlNode resourceNode in root.ChildNodes) {
#>
			<#= resourceNode.Name #>.Init();
<#
		}
#>
        }
	}
}